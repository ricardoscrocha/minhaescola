<?php

$path = $_GET['path'] ?? '';

if ($path === '' || strpos($path, '..') !== false) {
	http_response_code(400);
	exit('Bad Request');
}

$baseDir = realpath(__DIR__ . '/../public/node_modules');
$file = realpath($baseDir . '/' . $path);

if ($baseDir === false || $file === false || strpos($file, $baseDir) !== 0 || !is_file($file)) {
	http_response_code(404);
	exit('Not Found');
}

$extension = strtolower(pathinfo($file, PATHINFO_EXTENSION));
$contentTypes = [
	'css' => 'text/css; charset=utf-8',
	'js' => 'application/javascript; charset=utf-8',
	'map' => 'application/json; charset=utf-8',
	'json' => 'application/json; charset=utf-8',
	'svg' => 'image/svg+xml',
	'woff' => 'font/woff',
	'woff2' => 'font/woff2',
	'ttf' => 'font/ttf',
	'eot' => 'application/vnd.ms-fontobject'
];

$contentType = $contentTypes[$extension] ?? 'application/octet-stream';

header('Content-Type: ' . $contentType);
header('Cache-Control: public, max-age=31536000, immutable');
readfile($file);

